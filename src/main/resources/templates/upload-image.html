
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Upload Image</title>
	<link href="/css/main.css" rel="stylesheet" />
</head>
<body>
	<div class="content">
		<form class="login-form" id="uploadForm" style="max-width: 500px;">
			<h2>Upload Image</h2>
			<div style="width: 100%; margin-bottom: 18px;">
				<p style="text-align: center; font-size: 1.05rem; color: var(--color-subheading);">
					Select an image file to upload and start processing with Pixelmate's advanced tools.
				</p>
			</div>
			<input type="file" name="file" id="fileInput" accept="image/*" required style="margin-bottom: 18px; width: 100%;" />
			<button type="submit" class="btn btn-primary wide">Upload</button>
			<div id="errorMsg" class="alert alert-danger" style="display:none;"></div>
		</form>
	</div>
	<script>
		const form = document.getElementById('uploadForm');
		const errorMsg = document.getElementById('errorMsg');
		form.addEventListener('submit', function(e) {
			e.preventDefault();
			errorMsg.style.display = 'none';
			errorMsg.textContent = '';
			const fileInput = document.getElementById('fileInput');
			if (!fileInput.files.length) {
				errorMsg.textContent = 'Please select an image file.';
				errorMsg.style.display = 'block';
				return;
			}
			const formData = new FormData();
			formData.append('file', fileInput.files[0]);
			fetch('/api/session/pipeline/create-default', {
				method: 'POST',
				body: formData
			})
			.then(async response => {
				if (response.ok) {
					setTimeout(() => {
						window.location.href = '/editor';
					}, 1000);
				} else {
					let errorText = 'Upload failed.';
					try {
						const errorJson = await response.json();
						errorText = errorJson.message || JSON.stringify(errorJson);
					} catch (e) {}
					errorMsg.textContent = errorText;
					errorMsg.style.display = 'block';
				}
			})
			.catch(err => {
				errorMsg.textContent = 'Network error: ' + err;
				errorMsg.style.display = 'block';
			});
		});
	</script>
</body>
</html>
