<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Banning IP Dashboard</title>
	<style>
		body { font-family: Arial, sans-serif; margin: 2em; }
		h1 { color: #333; }
		.bans { margin-bottom: 2em; }
		table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }
		th, td { border: 1px solid #ccc; padding: 0.5em; text-align: left; }
		th { background: #f0f0f0; }
		.actions { margin-top: 1em; }
		input[type="text"], input[type="number"] { padding: 0.3em; }
		button { padding: 0.3em 1em; }
		.success { color: green; }
		.error { color: red; }
	</style>
</head>
<body>
	<h1>Banning IP Dashboard</h1>
	<div class="bans">
		<h2>Currently Banned IPs</h2>
		<div id="bans-container">Loading...</div>
	</div>

	<div class="actions">
		<h2>Ban an IP</h2>
		<form id="ban-ip-form">
			<label>IP Address:
				<input type="text" id="banIpInput" required>
			</label>
			<label>Duration (minutes):
				<input type="number" id="banDurationInput" min="1" value="60" required>
			</label>
			<button type="submit">Ban</button>
		</form>

		<h2>Unban an IP</h2>
		<form id="unban-ip-form">
			<label>IP Address:
				<input type="text" id="unbanIpInput" required>
			</label>
			<button type="submit">Unban</button>
		</form>
		<div id="message"></div>
	</div>

	<script>
		async function fetchBans() {
			const container = document.getElementById('bans-container');
			container.textContent = 'Loading...';
			try {
				const res = await fetch('/api/banning/banned-ips');
				if (!res.ok) throw new Error('Failed to fetch banned IPs');
				const data = await res.json();
				if (Object.keys(data).length === 0) {
					container.textContent = 'No IPs are currently banned.';
					return;
				}
				let html = '<table><tr><th>IP Address</th><th>Ban Expires At</th></tr>';
				for (const [ip, expiry] of Object.entries(data)) {
					html += `<tr><td>${ip}</td><td>${expiry}</td></tr>`;
				}
				html += '</table>';
				container.innerHTML = html;
			} catch (e) {
				container.innerHTML = `<span class="error">${e.message}</span>`;
			}
		}

		function showMessage(msg, isError = false) {
			const el = document.getElementById('message');
			el.textContent = msg;
			el.className = isError ? 'error' : 'success';
			setTimeout(() => { el.textContent = ''; }, 2500);
		}

		document.getElementById('ban-ip-form').addEventListener('submit', async e => {
			e.preventDefault();
			const ip = document.getElementById('banIpInput').value.trim();
			const duration = document.getElementById('banDurationInput').value;
			if (!ip || !duration) return;
			try {
				const params = new URLSearchParams({ ipAddress: ip, durationMinutes: duration });
				const res = await fetch(`/api/banning/ban-ip?${params.toString()}`, { method: 'POST' });
				if (!res.ok) throw new Error('Failed to ban IP');
				showMessage('IP banned.');
				fetchBans();
			} catch (e) {
				showMessage(e.message, true);
			}
		});

		document.getElementById('unban-ip-form').addEventListener('submit', async e => {
			e.preventDefault();
			const ip = document.getElementById('unbanIpInput').value.trim();
			if (!ip) return;
			try {
				const params = new URLSearchParams({ ipAddress: ip });
				const res = await fetch(`/api/banning/unban-ip?${params.toString()}`, { method: 'POST' });
				if (!res.ok) throw new Error('Failed to unban IP');
				showMessage('IP unbanned.');
				fetchBans();
			} catch (e) {
				showMessage(e.message, true);
			}
		});

		// Initial load
		fetchBans();
	</script>
</body>
</html>
